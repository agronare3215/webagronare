<!DOCTYPE html>
<html lang="es-MX">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Agronoré | Asesoría Agrícola Especializada para la Agricultura Moderna</title>
  <meta name="description"
    content="Transforma tu cosecha con Agronoré. Aumenta tus cosechas hasta un 40% con nuestros planes personalizados de agricultura de precisión. ¡Contáctanos y descubre cómo!" />

  <!-- Open Graph / Twitter -->
  <meta property="og:title" content="Agronoré — Asesoría Agrícola & Productos" />
  <meta property="og:description"
    content="Empoderamos al productor con asesoría técnica, fertilizantes y tecnología de precisión." />
  <meta property="og:image" content="/assets/og-image.jpg" />
  <meta name="twitter:card" content="summary_large_image" />

  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22 fill=%22%2316a34a%22><path d=%22M17 8C8 10 5.9 16.17 3.82 21.34l1.89.66C7.62 17.11 9.87 12 17 10V8z%22/><path d=%22M17 8c0-2.21-1.79-4-4-4s-4 1.79-4 4c0 .74.2 1.42.54 2.02.85 1.5 2.13 2.87 3.56 4.02L17 10.8V8z%22/></svg>" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Leaflet CSS (fallback cuando Google no esté disponible) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />

  <!-- Custom CSS -->
  <link rel="stylesheet" href="assets/css/styles.css">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: {
              50: '#f0fdf4', 100: '#dcfce7', 200: '#bbf7d0', 300: '#86efac',
              400: '#4ade80', 500: '#22c55e', 600: '#16a34a', 700: '#15803d',
              800: '#166534', 900: '#14532d'
            },
            dark: { 900: '#18181b', 800: '#27272a' },
            secondary: { 500: '#f59e0b' }
          },
          fontFamily: { poppins: ['Poppins', 'sans-serif'] },
        }
      }
    }
  </script>

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      color: #374151;
      background-color: #fff;
      scroll-behavior: smooth;
    }

    .nav-link {
      position: relative;
      transition: color 0.3s ease;
    }

    .nav-link::after {
      content: '';
      position: absolute;
      width: 0;
      height: 2px;
      bottom: -4px;
      left: 0;
      background-color: #16a34a;
      transition: width 0.3s ease;
    }

    .nav-link:hover::after,
    .nav-link.active::after {
      width: 100%;
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.9);
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      max-width: 90%;
      max-height: 80%;
      display: block;
      margin: auto;
      border-radius: 1rem;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: scale(0.9);
      }

      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .modal-caption {
      margin-top: 1rem;
      color: white;
      font-size: 1.25rem;
      text-align: center;
    }

    .close-btn {
      position: absolute;
      top: 1.5rem;
      right: 2.5rem;
      color: #fff;
      font-size: 2.5rem;
      font-weight: bold;
      transition: 0.3s;
      cursor: pointer;
      z-index: 101;
    }

    .animate-on-scroll {
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.6s ease, transform 0.6s ease;
    }

    .animate-on-scroll.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .delay-100 {
      transition-delay: 100ms;
    }

    .delay-200 {
      transition-delay: 200ms;
    }

    .mobile-menu {
      transform: translateX(100%);
      transition: transform 0.3s ease-in-out;
    }

    .mobile-menu.active {
      transform: translateX(0);
    }

    .input-focus:focus {
      box-shadow: 0 0 0 2px rgba(22, 163, 74, 0.3);
      border-color: #16a34a;
    }

    .whatsapp-float {
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7);
      }

      70% {
        box-shadow: 0 0 0 12px rgba(34, 197, 94, 0);
      }

      100% {
        box-shadow: 0 0 0 0 rgba(34, 197, 94, 0);
      }
    }

    .hero-section {
      background-image: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('assets/hero-bg.jpg');
      background-size: cover;
      background-position: center;
    }

    #mapa-ubicaciones {
      height: 320px;
      border-radius: 1rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }

    .map-error {
      margin-top: 12px;
      background: #fff9f0;
      border: 1px solid #fde3a7;
      color: #7a5a00;
      padding: 16px;
      border-radius: 8px;
      display: none;
    }

    .testimonial-slide {
      display: none;
    }

    .testimonial-slide.active {
      display: block;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: .5rem;
      padding: .25rem .5rem;
      border-radius: .5rem;
      background: #ecfdf5;
      color: #065f46;
      font-weight: 600;
    }

    .lazy {
      opacity: 0;
      transition: opacity .4s ease;
    }

    .lazy.loaded {
      opacity: 1;
    }

    @media (min-width: 1024px) {
      .acerca-grid {
        display: grid;
        grid-template-columns: 1fr 480px;
        gap: 3rem;
        align-items: center;
      }
    }

    .calendly-wrapper {
      display: none;
    }

    /* Calendly removed */
  </style>
</head>

<body class="bg-gray-50 text-gray-800">

  <div id="messageModal" class="modal" aria-hidden="true">
    <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm mx-auto text-center">
      <h4 id="messageModalTitle" class="font-bold text-lg mb-2 text-gray-900"></h4>
      <p id="messageModalText" class="text-gray-600 mb-4"></p>
      <button onclick="closeMessageModal()"
        class="w-full bg-primary-600 text-white py-2 rounded-md hover:bg-primary-700 transition-colors">Cerrar</button>
    </div>
  </div>

  <!-- Accessibility skip link -->
  <a class="sr-only focus:not-sr-only p-3 bg-primary-600 text-white fixed top-4 left-4 rounded-md z-50"
    href="#main-content">Saltar al contenido</a>

  <header id="header" class="sticky top-0 z-50 bg-white border-b border-gray-100 transition-shadow duration-300"
    role="banner">
    <div class="container mx-auto px-6">
      <div class="flex items-center justify-between h-21">
        <a href="#inicio" class="block" aria-label="Ir al inicio"><img src="assets/logo.png" alt="Logo de Agronoré"
            class="h-20 w-auto"></a>
        <nav class="hidden md:flex items-center space-x-8" aria-label="Menú principal">
          <a href="#inicio" class="nav-link active font-medium text-primary-600">Inicio</a>
          <a href="#acerca-de" class="nav-link font-medium hover:text-primary-600">Nosotros</a>
          <a href="#diferencia" class="nav-link font-medium hover:text-primary-600">Nuestra Ventaja</a>
          <a href="#servicios" class="nav-link font-medium hover:text-primary-600">Servicios</a>
          <a href="#equipo" class="nav-link font-medium hover:text-primary-600">Equipo</a>
          <a href="#galeria" class="nav-link font-medium hover:text-primary-600">Galería</a>
          <a href="#testimonios" class="nav-link font-medium hover:text-primary-600">Testimonios</a>
          <a href="#blog" class="nav-link font-medium hover:text-primary-600">Blog</a>
        </nav>
        <div class="hidden md:flex">
          <a href="#contacto"
            class="border-2 border-gray-900 text-gray-900 px-6 py-2 rounded-md font-bold hover:bg-gray-900 hover:text-white transition-colors">CONTACTO</a>
        </div>
        <button id="menu-button" class="md:hidden text-gray-800 text-2xl p-2 z-50" aria-label="Abrir menú"
          aria-expanded="false" aria-controls="mobile-menu">
          <svg id="menu-open-icon" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
          </svg>
          <svg id="menu-close-icon" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
    </div>
  </header>

  <div id="mobile-menu"
    class="mobile-menu fixed top-0 right-0 w-full h-full bg-white z-40 p-6 flex flex-col justify-center items-center"
    role="menu" aria-hidden="true">
    <nav class="flex flex-col space-y-8 text-center">
      <a href="#inicio" class="text-gray-800 text-2xl py-2 font-medium">Inicio</a>
      <a href="#acerca-de" class="text-gray-800 text-2xl py-2 font-medium">Nosotros</a>
      <a href="#diferencia" class="text-gray-800 text-2xl py-2 font-medium">Nuestra Ventaja</a>
      <a href="#servicios" class="text-gray-800 text-2xl py-2 font-medium">Servicios</a>
      <a href="#equipo" class="text-gray-800 text-2xl py-2 font-medium">Equipo</a>
      <a href="#galeria" class="text-gray-800 text-2xl py-2 font-medium">Galería</a>
      <a href="#testimonios" class="text-gray-800 text-2xl py-2 font-medium">Testimonios</a>
      <a href="#blog" class="text-gray-800 text-2xl py-2 font-medium">Blog</a>
      <div class="pt-8"><a href="#contacto"
          class="bg-primary-600 text-white px-8 py-4 rounded-lg font-bold text-lg">CONTACTO</a></div>
    </nav>
  </div>

  <main id="main-content" role="main">
    <section id="inicio" class="hero-section h-[calc(100vh-80px)] min-h-[600px] flex items-center text-white"
      aria-labelledby="hero-title">
      <div class="container mx-auto px-6">
        <div class="max-w-3xl animate-on-scroll">
          <span class="badge">+7 años · Atención en Michoacán</span>
          <h1 id="hero-title" class="text-5xl md:text-6xl lg:text-7xl font-bold mb-6 leading-tight">
            Innovación y Ciencia para
            la Agricultura del Futuro</h1>
          <p class="text-xl md:text-2xl text-gray-200 mb-10">Llevamos tu producción al
            siguiente nivel con
            asesoría de precisión y tecnología de vanguardia.</p>

          <!-- Micro lead form (telefono + cultivo) -->
          <form id="hero-lead" class="grid sm:grid-cols-3 gap-3 mb-6" action="https://formspree.io/f/mzzakqk"
            method="POST">
            <input name="nombre" required placeholder="Nombre"
              class="px-4 py-3 rounded-md border border-transparent focus:outline-none input-focus col-span-1 sm:col-span-1">
            <select id="hero-cultivo" name="cultivo" aria-label="Cultivo"
              class="px-4 py-3 rounded-md border border-transparent focus:outline-none input-focus col-span-1 sm:col-span-1"
              required>
              <option value="">Cultivo</option>
              <option value="berries">Berries</option>
              <option value="maiz">Maíz</option>
              <option value="aguacate">Aguacate</option>
              <option value="otros">Otros</option>
            </select>
            <button type="submit" class="bg-secondary-500 text-white px-6 py-3 rounded-md font-bold">Solicitar
              diagnóstico</button>
          </form>

          <div class="flex items-center gap-4">
            <a href="#contacto" class="text-sm font-medium underline">¿Prefieres hablar con nosotros?</a>
            <a href="tel:+524437924923" class="text-sm font-semibold">Llámanos: 443 792 4923</a>
          </div>
          <div class="mt-6"><a href="/assets/brochure.pdf" class="text-sm text-gray-200 underline">Descargar
              folleto (PDF)</a></div>
        </div>
      </div>
    </section>

    <section id="acerca-de" class="py-20 md:py-28 bg-white">
      <div class="container mx-auto px-6">
        <div class="acerca-grid">
          <div class="animate-on-scroll">
            <span class="text-primary-600 font-semibold tracking-wider">SOBRE
              NOSOTROS</span>
            <h2 class="text-4xl md:text-5xl font-bold text-gray-900 mt-2 mb-6">Tu
              Aliado en Agricultura de
              Precisión</h2>
            <p class="text-lg text-gray-600 mb-6">En Agronoré, fusionamos más de 7
              años de experiencia en
              campo con tecnología avanzada para ofrecerte soluciones que
              generan resultados medibles.
              Somos tu
              socio estratégico, brindándote la asesoría y los productos que
              necesitas para una producción
              rentable y
              sostenible.</p>
            <div class="space-y-4">
              <div class="flex items-start"><svg class="h-6 w-6 mr-3 mt-1 text-primary-600 flex-shrink-0" fill="none"
                  viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <p class="text-gray-600"><strong class="text-gray-800">Misión:</strong> Empoderar a los
                  agricultores con herramientas y conocimiento
                  para que superen sus metas de
                  producción de manera sostenible.</p>
              </div>
              <div class="flex items-start"><svg class="h-6 w-6 mr-3 mt-1 text-primary-600 flex-shrink-0" fill="none"
                  viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M3 21v-4m0 0V5a2 2 0 012-2h6.5l1 1H21l-3 6 3 6h-8.5l-1-1H5a2 2 0 00-2 2zm9-13.5V9" />
                </svg>
                <p class="text-gray-600"><strong class="text-gray-800">Visión:</strong> Liderar la
                  transformación del sector agrícola en México,
                  impulsando una nueva era de
                  agricultura inteligente y
                  eficiente.</p>
              </div>
            </div>
          </div>

          <div class="animate-on-scroll delay-100">
            <img data-src="assets/acerca.png" loading="lazy" alt="Agrónomo revisando un cultivo"
              class="rounded-xl shadow-lg lazy">
          </div>
        </div>
    </section>

    <section id="diferencia" class="py-20 md:py-28 bg-gray-50">
      <div class="container mx-auto px-6">
        <div class="text-center max-w-3xl mx-auto mb-16 animate-on-scroll">
          <span class="text-primary-600 font-semibold tracking-wider">NUESTRA
            VENTAJA</span>
          <h2 class="text-4xl md:text-5xl font-bold text-gray-900 mt-2 mb-4">¿Por Qué
            Elegir Agronoré?</h2>
          <p class="text-lg text-gray-600">Con enfoque en datos, soporte continuo y tecnología, ayudamos a
            productores a aumentar rendimiento y rentabilidad.</p>
        </div>
        <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8">
          <div class="bg-white p-6 rounded-lg text-center shadow-md animate-on-scroll">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-4 text-primary-600" fill="none"
              viewBox="0 0 24 24" stroke="currentColor">
              <path d="M12 14l9-5-9-5-9 5 9 5z" />
              <path
                d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M12 14l9-5-9-5-9 5 9 5zm0 0l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14zm-4 6v-7.5l4-2.222" />
            </svg>
            <h3 class="font-bold text-xl mb-2">Resultados Medibles</h3>
            <p class="text-gray-600">Nos enfocamos en datos para ofrecerte un
              retorno de inversión claro y
              tangible.</p>
          </div>
          <div class="bg-white p-6 rounded-lg text-center shadow-md animate-on-scroll delay-100">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-4 text-primary-600" fill="none"
              viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M17 8h2a2 2 0 012 2v6a2 2 0 01-2 2h-2v4l-4-4H9a2 2 0 01-2-2V7a2 2 0 012-2h2.586a1 1 0 01.707.293l2.414 2.414a1 1 0 00.707.293H17z" />
            </svg>
            <h3 class="font-bold text-xl mb-2">Soporte Continuo</h3>
            <p class="text-gray-600">Te acompañamos durante todo el ciclo de cultivo
              con asesoría en tiempo
              real.</p>
          </div>
          <div class="bg-white p-6 rounded-lg text-center shadow-md animate-on-scroll delay-200">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-4 text-primary-600" fill="none"
              viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
            </svg>
            <h3 class="font-bold text-xl mb-2">Productos de Calidad</h3>
            <p class="text-gray-600">Trabajamos con los mejores insumos del mercado
              para garantizar la
              eficacia.</p>
          </div>
          <div class="bg-white p-6 rounded-lg text-center shadow-md animate-on-scroll delay-200">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-4 text-primary-600" fill="none"
              viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
            </svg>
            <h3 class="font-bold text-xl mb-2">Tecnología de Vanguardia</h3>
            <p class="text-gray-600">Usamos IA, drones y sensores para tomar
              decisiones más inteligentes y
              precisas.</p>
          </div>
        </div>
      </div>
    </section>

    <section id="servicios" class="py-20 md:py-28 bg-white">
      <div class="container mx-auto px-6">
        <div class="text-center max-w-3xl mx-auto mb-16 animate-on-scroll">
          <span class="text-primary-600 font-semibold tracking-wider">NUESTROS
            SERVICIOS</span>
          <h2 class="text-4xl md:text-5xl font-bold text-gray-900 mt-2 mb-4">Soluciones
            Integrales para el
            Campo</h2>
          <p class="text-lg text-gray-600">Ofrecemos un portafolio completo de servicios
            diseñados para
            optimizar cada etapa de tu ciclo productivo.</p>
        </div>
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
          <div class="bg-gray-50 p-8 rounded-lg shadow-md animate-on-scroll">
            <h3 class="font-bold text-xl mb-2">Asesoría Personalizada</h3>
            <p class="text-gray-600">Planes de nutrición y manejo de cultivos a la
              medida, basados en
              análisis de suelo y agua para maximizar tu rendimiento.</p>
          </div>
          <div class="bg-gray-50 p-8 rounded-lg shadow-md animate-on-scroll delay-100">
            <h3 class="font-bold text-xl mb-2">Agricultura de Precisión</h3>
            <p class="text-gray-600">Implementamos tecnología de vanguardia como
              drones, sensores y software
              de mapeo para una gestión eficiente y precisa de tus recursos.
            </p>
          </div>
          <div class="bg-gray-50 p-8 rounded-lg shadow-md animate-on-scroll delay-200">
            <h3 class="font-bold text-xl mb-2">Venta de Insumos Especializados</h3>
            <p class="text-gray-600">Te proveemos con los mejores productos del
              mercado, desde fertilizantes
              de alta eficiencia hasta soluciones de biocontrol de plagas.</p>
          </div>
        </div>
      </div>
    </section>

    <section id="equipo" class="py-20 md:py-28 bg-white">
      <div class="container mx-auto px-6">
        <div class="grid lg:grid-cols-2 gap-16 items-center">
          <div class="animate-on-scroll delay-100 order-2 lg:order-1"><img data-src="assets/equipo.jpg"
              alt="El equipo de Agronoré en el campo" class="rounded-xl shadow-lg lazy"></div>
          <div class="animate-on-scroll order-1 lg:order-2">
            <span class="text-primary-600 font-semibold tracking-wider">NUESTRO
              EQUIPO</span>
            <h2 class="text-4xl md:text-5xl font-bold text-gray-900 mt-2 mb-6">
              Expertos Apasionados por el
              Campo</h2>
            <p class="text-lg text-gray-600 mb-6">Nuestro mayor activo es nuestro
              equipo. Combinamos la
              experiencia de agrónomos veteranos con la energía de jóvenes
              innovadores para ofrecerte un
              servicio inigualable. Estamos comprometidos con tu éxito.</p>
          </div>
        </div>
      </div>
    </section>

    <section id="galeria" class="py-20 md:py-28 bg-gray-50">
      <div class="container mx-auto px-6">
        <div class="text-center max-w-3xl mx-auto mb-16 animate-on-scroll">
          <span class="text-primary-600 font-semibold tracking-wider">GALERÍA</span>
          <h2 class="text-4xl md:text-5xl font-bold text-gray-900 mt-2 mb-4">Nuestro
            Trabajo en Acción</h2>
          <p class="text-lg text-gray-600">Un vistazo a nuestros proyectos, tecnología y
            los resultados que
            generamos en el campo.</p>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
          <div class="group relative cursor-pointer overflow-hidden rounded-lg shadow-md animate-on-scroll"
            onclick="openModal('assets/galeria1.jpg', 'Cultivo de berries con tecnología de riego por goteo')">
            <img data-src="assets/galeria1.jpg" alt="Cultivo de berries" loading="lazy"
              class="w-full h-72 object-cover transition-transform duration-300 group-hover:scale-110 lazy">
            <div
              class="absolute inset-0 bg-primary-800 bg-opacity-70 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
              <p class="text-white text-lg font-semibold text-center px-4">Ver
                Imagen</p>
            </div>
          </div>
          <div class="group relative cursor-pointer overflow-hidden rounded-lg shadow-md animate-on-scroll delay-100"
            onclick="openModal('assets/galeria2.png', 'Análisis de plagas en hojas de maíz')">
            <img data-src="assets/galeria2.png" alt="Análisis de plagas" loading="lazy"
              class="w-full h-72 object-cover transition-transform duration-300 group-hover:scale-110 lazy">
            <div
              class="absolute inset-0 bg-primary-800 bg-opacity-70 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
              <p class="text-white text-lg font-semibold text-center px-4">Ver
                Imagen</p>
            </div>
          </div>
          <div class="group relative cursor-pointer overflow-hidden rounded-lg shadow-md animate-on-scroll delay-200"
            onclick="openModal('assets/galeria3.jpg', 'Dron para mapeo de cultivos')">
            <img data-src="assets/galeria3.jpg" alt="Dron para mapeo" loading="lazy"
              class="w-full h-72 object-cover transition-transform duration-300 group-hover:scale-110 lazy">
            <div
              class="absolute inset-0 bg-primary-800 bg-opacity-70 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
              <p class="text-white text-lg font-semibold text-center px-4">Ver
                Imagen</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="testimonios" class="py-20 md:py-28 bg-white">
      <div class="container mx-auto px-6">
        <div class="text-center max-w-3xl mx-auto mb-16 animate-on-scroll">
          <span class="text-primary-600 font-semibold tracking-wider">TESTIMONIOS</span>
          <h2 class="text-4xl md:text-5xl font-bold text-gray-900 mt-2 mb-4">La Voz de
            Nuestros Clientes</h2>
        </div>
        <div class="relative max-w-3xl mx-auto animate-on-scroll">
          <div id="testimonial-container" class="relative">
            <div class="testimonial-slide active text-center">
              <img data-src="assets/testimonio1.jpg" alt="Cliente satisfecho 1" loading="lazy"
                class="w-24 h-24 rounded-full mx-auto mb-4 object-cover lazy">
              <p class="text-lg text-gray-600 italic mb-4">"Desde que
                trabajamos con Agronoré, nuestro
                rendimiento en aguacate ha aumentado un 30%. Su
                conocimiento técnico y seguimiento son
                incomparables."</p>
              <p class="font-bold text-gray-900">- Juan García, Productor de
                Uruapan</p>
            </div>
            <div class="testimonial-slide text-center">
              <img data-src="assets/testimonio2.jpg" alt="Cliente satisfecho 2" loading="lazy"
                class="w-24 h-24 rounded-full mx-auto mb-4 object-cover lazy">
              <p class="text-lg text-gray-600 italic mb-4">"El plan de
                nutrición para mis berries fue un
                cambio total. Mejoró la calidad de la fruta y la salud
                de las plantas. Totalmente
                recomendados."</p>
              <p class="font-bold text-gray-900">- María Rodríguez, Productora
                de Zamora</p>
            </div>
          </div>
          <button id="prev-testimonial"
            class="absolute top-1/2 left-0 transform -translate-y-1/2 -translate-x-12 bg-gray-200 hover:bg-gray-300 rounded-full p-2 transition"
            aria-label="Testimonio anterior"><svg class="h-6 w-6 text-gray-700" fill="none" viewBox="0 0 24 24"
              stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg></button>
          <button id="next-testimonial"
            class="absolute top-1/2 right-0 transform -translate-y-1/2 translate-x-12 bg-gray-200 hover:bg-gray-300 rounded-full p-2 transition"
            aria-label="Siguiente testimonio"><svg class="h-6 w-6 text-gray-700" fill="none" viewBox="0 0 24 24"
              stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg></button>
        </div>
      </div>
    </section>

    <section id="blog" class="py-20 md:py-28 bg-white">
      <div class="container mx-auto px-6">
        <div class="text-center max-w-3xl mx-auto mb-16 animate-on-scroll">
          <span class="text-primary-600 font-semibold tracking-wider">BLOG</span>
          <h2 class="text-4xl md:text-5xl font-bold text-gray-900 mt-2 mb-4">Noticias y
            Consejos del Campo
          </h2>
          <p class="text-lg text-gray-600">Mantente actualizado con las últimas tendencias
            y consejos de
            nuestros expertos.</p>
        </div>
        <div class="grid md:grid-cols-3 gap-8">
          <div class="bg-gray-50 rounded-lg shadow-md overflow-hidden animate-on-scroll">
            <img data-src="https://images.unsplash.com/photo-1523348837708-15d4a09cfac2?auto=format&fit=crop&w=800&q=80"
              alt="Riego" loading="lazy" class="w-full h-48 object-cover lazy">
            <div class="p-6"><span class="text-sm text-gray-500">Septiembre 03, 2025</span>
              <h3 class="font-bold text-xl my-2">5 Tecnologías que están
                revolucionando el riego</h3><a href="#" class="text-primary-600 font-semibold hover:underline">Leer más
                &rarr;</a>
            </div>
          </div>
          <div class="bg-gray-50 rounded-lg shadow-md overflow-hidden animate-on-scroll delay-100"><img
              data-src="https://images.unsplash.com/photo-1492496913980-50133821932d?auto=format&fit=crop&w=800&q=80"
              alt="Plagas" loading="lazy" class="w-full h-48 object-cover lazy">
            <div class="p-6"><span class="text-sm text-gray-500">Agosto 28, 2025</span>
              <h3 class="font-bold text-xl my-2">Manejo Integrado de Plagas:
                Guía para el productor</h3><a href="#" class="text-primary-600 font-semibold hover:underline">Leer más
                &rarr;</a>
            </div>
          </div>
          <div class="bg-gray-50 rounded-lg shadow-md overflow-hidden animate-on-scroll delay-200"><img
              data-src="https://images.unsplash.com/photo-1594396417585-069c1a1286ad?auto=format&fit=crop&w=800&q=80"
              alt="Suelo" loading="lazy" class="w-full h-48 object-cover lazy">
            <div class="p-6"><span class="text-sm text-gray-500">Agosto 15, 2025</span>
              <h3 class="font-bold text-xl my-2">La importancia del análisis
                de suelo antes de sembrar
              </h3><a href="#" class="text-primary-600 font-semibold hover:underline">Leer más &rarr;</a>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- CONTACTO -->
    <section id="contacto" class="py-20 md:py-28 bg-gray-50">
      <div class="container mx-auto px-6">
        <div class="text-center max-w-3xl mx-auto mb-16 animate-on-scroll">
          <h2 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">Inicia tu <span
              class="text-primary-600">Transformación
              Hoy</span></h2>
          <p class="text-lg text-gray-600">Completa el formulario o contáctanos
            directamente. Un experto te
            atenderá en menos de 24 horas.</p>
        </div>

        <div class="grid lg:grid-cols-2 gap-12 items-start">
          <div class="animate-on-scroll">
            <div class="space-y-6 text-lg">
              <h3 class="text-2xl font-bold text-gray-900">Nuestras Sucursales
              </h3>
              <div class="flex items-start"><svg class="h-6 w-6 mr-4 mt-1 text-primary-600 flex-shrink-0" fill="none"
                  viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
                <p class="text-gray-600">Cda. de Hidalgo 305, Copándaro,
                  Mich.</p>
              </div>
              <div class="flex items-start"><svg class="h-6 w-6 mr-4 mt-1 text-primary-600 flex-shrink-0" fill="none"
                  viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
                <p class="text-gray-600">Guadalupe Victoria 1962, 61620
                  Cuanajo, Mich.</p>
              </div>
              <div class="flex items-start"><svg class="h-6 w-6 mr-4 mt-1 text-primary-600 flex-shrink-0" fill="none"
                  viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
                <p class="text-gray-600">El Capricho, Zamora de Hidalgo, Mich.</p>
              </div>
              <h3 class="text-2xl font-bold text-gray-900 pt-6">Información de
                Contacto</h3>
              <div class="flex items-start"><svg class="h-6 w-6 mr-4 mt-1 text-primary-600 flex-shrink-0" fill="none"
                  viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                </svg><a id="email-contact" href="mailto:hola@agronare.com"
                  class="text-gray-600 hover:text-primary-600">hola@agronare.com</a></div>
              <div class="flex items-start"><svg class="h-6 w-6 mr-4 mt-1 text-primary-600 flex-shrink-0" fill="none"
                  viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <p class="text-gray-600">Lunes a Viernes: 9:00 AM - 6:00
                  PM</p>
              </div>
            </div>

            <!-- MAP -->
            <div class="mt-8">
              <div id="mapa-ubicaciones" aria-label="Mapa con nuestras sucursales"></div>
              <div id="map-error" class="map-error" role="status" aria-live="polite">
                No se pudo cargar el mapa de Google. Se mostrará un mapa alternativo (OpenStreetMap).
              </div>
            </div>
          </div>

          <div class="bg-white p-8 md:p-12 rounded-xl shadow-lg animate-on-scroll delay-100">
            <form id="contact-form" class="space-y-6" action="https://formspree.io/f/mzzakqk" method="POST">
              <input type="hidden" name="utm_source" id="utm_source">
              <input type="hidden" name="utm_medium" id="utm_medium">
              <input type="hidden" name="utm_campaign" id="utm_campaign">

              <div><label for="contacto-nombre" class="block text-sm font-medium text-gray-700 mb-1">Nombre completo
                  *</label><input id="contacto-nombre" name="nombre" type="text" required
                  class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 input-focus">
              </div>

              <div><label for="contacto-cultivo" class="block text-sm font-medium text-gray-700 mb-1">Tipo
                  de cultivo
                  *</label><select id="contacto-cultivo" name="cultivo" required
                  class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 input-focus">
                  <option value="">Selecciona tu cultivo</option>
                  <option value="berries">Berries</option>
                  <option value="maiz">Maíz</option>
                  <option value="aguacate">Aguacate</option>
                  <option value="otros">Otros</option>
                </select></div>

              <div><label for="contacto-telefono" class="block text-sm font-medium text-gray-700 mb-1">Teléfono
                  *</label><input id="contacto-telefono" name="telefono" type="tel" required
                  class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 input-focus"
                  placeholder="Ej: 443 123 4567"></div>

              <div><label for="contacto-mensaje" class="block text-sm font-medium text-gray-700 mb-1">¿Cuál es tu mayor
                  desafío? *</label><textarea id="contacto-mensaje" name="mensaje" required
                  class="w-full px-4 py-3 rounded-lg border border-gray-300 min-h-[120px] focus:outline-none focus:ring-2 input-focus"
                  placeholder="Describe con detalle tu problema para recibir una sugerencia de nuestra IA. Ej: Mis aguacates tienen manchas negras..."></textarea>
              </div>

              <div class="text-center"><button type="button" id="gemini-suggester-btn"
                  class="w-full bg-secondary-500 text-white px-6 py-3 rounded-md font-bold text-lg shadow-md hover:bg-orange-500 transition-colors tracking-wider flex items-center justify-center">✨
                  Obtener Sugerencia de IA</button></div>

              <div id="gemini-response-container"
                class="mt-4 p-4 border-l-4 border-primary-500 bg-primary-50 hidden rounded-r-lg">
                <h4 class="font-bold text-lg text-primary-700">
                  Sugerencia de Nuestro Asistente IA:</h4>
                <div id="gemini-loader" class="flex items-center my-4 hidden"><svg
                    class="animate-spin h-5 w-5 text-primary-600" xmlns="http://www.w3.org/2000/svg" fill="none"
                    viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor"
                      d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                    </path>
                  </svg>
                  <p class="ml-2 text-gray-600">Analizando tu
                    caso...</p>
                </div>
                <p id="gemini-response-text" class="text-gray-700"></p>
              </div>

              <button type="submit"
                class="w-full bg-primary-600 text-white px-6 py-4 rounded-md font-bold text-lg shadow-md hover:bg-primary-700 transition-colors tracking-wider">ENVIAR
                PARA DIAGNÓSTICO COMPLETO</button>
            </form>

            <!-- Calendly removed as requested -->
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="bg-dark-900 text-white" role="contentinfo">
    <div class="container mx-auto px-6 py-12">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-8 text-center md:text-left items-center">
        <div class="md:col-span-2"><img src="assets/logo.png" alt="Logo de Agronoré"
            class="h-12 w-auto mb-4 mx-auto md:mx-0 filter invert">
          <p class="text-gray-400 max-w-md mx-auto md:mx-0">Innovación y ciencia para la
            agricultura del futuro.</p>
        </div>
        <div>
          <h4 class="text-lg font-semibold mb-4">Contacto</h4>
          <ul class="space-y-2 text-gray-400">
            <li><a href="tel:+524437924923" class="hover:text-white">443 792
                4923</a></li>
            <li><a id="email-footer" href="mailto:hola@agronare.com" class="hover:text-white">hola@agronare.com</a></li>
          </ul>
        </div>
        <div>
          <h4 class="text-lg font-semibold mb-4">Legal</h4>
          <ul class="space-y-2 text-gray-400">
            <li><a href="#" class="hover:text-white">Aviso de Privacidad</a></li>
            <li><a href="#" class="hover:text-white">Términos y Condiciones</a></li>
          </ul>
        </div>
      </div>
      <div class="mt-10 pt-6 border-t border-gray-800 text-center text-gray-500 text-sm">
        <p>© <span id="year"></span> Agronoré — Todos los derechos reservados.</p>
      </div>
    </div>
  </footer>

  <a id="wa-cta" href="https://wa.me/524437924923?text=Hola%20Agronore,%20quiero%20un%20diagnostico" target="_blank"
    rel="noopener noreferrer" aria-label="Contactar por WhatsApp"
    class="fixed bottom-6 right-6 z-50 bg-green-500 text-white p-4 rounded-full shadow-lg transition-transform hover:scale-110 whatsapp-float">
    <svg class="h-8 w-8" fill="currentColor" viewBox="0 0 24 24">
      <path
        d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.198.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.297-.497.099-.198.05-.371-.025-.52-.076-.15-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.478 0 1.46.732 2.883.83 3.032.099.148 1.354 2.059 3.256 2.876.909.389 1.653.629 2.002.777.704.297 1.356.21 1.958-.075.586-.28 1.652-.966 1.898-1.898.246-.93 0-1.722-.074-1.995z" />
    </svg>
  </a>

  <div id="imageModal" class="modal" aria-hidden="true">
    <span class="close-btn" onclick="closeModal()" aria-label="Cerrar">&times;</span>
    <img class="modal-content" id="modalImage" alt="Imagen ampliada del caso de éxito">
    <div id="modalCaption" class="modal-caption"></div>
  </div>

  <!-- Leaflet JS (fallback) -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

  <script>
    // ------ CONFIG
    const EMAIL_CONTACT = 'hola@agronare.com';

    // Insertaste tu API key aquí:
    const MAPS_KEY = 'AIzaSyBwlxzFSan0t2pGHYaRiHJBV9t1BF4bO_s';

    // Coordenadas de las sucursales
    const SUCURSALES = [
      { nombre: 'Sucursal Zamora', lat: 19.9569, lng: -102.2185, direccion: 'El Capricho, Zamora de Hidalgo, Mich.' },
      { nombre: 'Sucursal Cuanajo', lat: 19.4987, lng: -101.6066, direccion: 'Guadalupe Victoria 1962, Cuanajo, Mich.' },
      { nombre: 'Sucursal Copándaro', lat: 19.8944, lng: -101.3178, direccion: 'Cda. de Hidalgo 305, Copándaro, Mich.' }
    ];

    // Mostrar el año en el footer
    document.getElementById('year').textContent = new Date().getFullYear();

    // --- MAPS: prefer Google, fallback Leaflet ---
    function initLeafletMap() {
      try {
        if (window._leafletInitialized) return;
        window._leafletInitialized = true;
        const container = document.getElementById('mapa-ubicaciones');
        container.innerHTML = '';
        const center = [19.7028, -101.1923]; // Center of Michoacán
        const map = L.map('mapa-ubicaciones', { center: center, zoom: 9 });
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        const markers = [];
        SUCURSALES.forEach(s => {
          const m = L.marker([s.lat, s.lng]).addTo(map).bindPopup(`<strong>${s.nombre}</strong><div>${s.direccion}</div><div><a target="_blank" rel="noopener" href="https://www.google.com/maps/dir/?api=1&destination=${s.lat},${s.lng}">Indicaciones (Google)</a></div>`);
          markers.push(m);
        });

        if (markers.length) {
          const group = new L.featureGroup(markers);
          map.fitBounds(group.getBounds().pad(0.2));
        } else {
          map.setView(center, 9);
        }
        const me = document.getElementById('map-error'); if (me) me.style.display = 'none';
      } catch (err) {
        console.error('initLeafletMap error', err);
        const me = document.getElementById('map-error'); if (me) { me.style.display = 'block'; me.textContent = 'No se pudo inicializar el mapa de respaldo.'; }
      }
    }

    // Google Maps handling with fallback: global initMap used as callback
    window.initMap = function () {
      try {
        if (!window.google || !window.google.maps) throw new Error('Google Maps no disponible');
        const centerCoords = { lat: 19.7028, lng: -101.1923 }; // Center of Michoacán
        const map = new google.maps.Map(document.getElementById('mapa-ubicaciones'), {
          center: centerCoords,
          zoom: 9,
          mapTypeControl: false,
          streetViewControl: false,
          fullscreenControl: true
        });

        const bounds = new google.maps.LatLngBounds();
        const iconUrl = 'assets/marker-green.png';

        SUCURSALES.forEach(s => {
          const pos = new google.maps.LatLng(s.lat, s.lng);
          const marker = new google.maps.Marker({
            position: pos,
            map,
            title: s.nombre,
            icon: { url: iconUrl, scaledSize: new google.maps.Size(36, 36) }
          });
          const infow = new google.maps.InfoWindow({ content: `<strong>${s.nombre}</strong><div>${s.direccion}</div><a target="_blank" rel="noopener" href="https://www.google.com/maps/dir/?api=1&destination=${s.lat},${s.lng}">Indicaciones</a>` });
          marker.addListener('click', () => infow.open(map, marker));
          bounds.extend(pos);
        });

        if (SUCURSALES.length > 0) {
          map.fitBounds(bounds);
          if (SUCURSALES.length === 1) {
            map.setZoom(15); // Zoom closer for a single point
          }
        }

        const me = document.getElementById('map-error'); if (me) me.style.display = 'none';

      } catch (err) {
        console.error('initMap fallo, fallback a Leaflet:', err);
        document.getElementById('map-error').style.display = 'block';
        initLeafletMap();
      }
    };

    // If Google auth fails (e.g., ExpiredKeyMapError), Google calls this function
    window.gm_authFailure = function () {
      console.error('Google Maps auth failure. Fallback a Leaflet.');
      const me = document.getElementById('map-error'); if (me) me.style.display = 'block';
      initLeafletMap();
    };

    function loadGoogleMapsScript() {
      if (!MAPS_KEY || MAPS_KEY === 'MAPS_KEY_HERE') { console.warn('Google Maps API key no configurada; usando Leaflet.'); initLeafletMap(); return; }
      if (window._mapsScriptLoaded) {
        if (window.google && window.google.maps) window.initMap();
        else initLeafletMap();
        return;
      }
      window._mapsScriptLoaded = true;
      const s = document.createElement('script');
      s.src = `https://maps.googleapis.com/maps/api/js?key=${encodeURIComponent(MAPS_KEY)}&callback=initMap&v=weekly`;
      s.async = true; s.defer = true;
      s.onerror = function (e) {
        console.error('Error al cargar Google Maps JS', e);
        const me = document.getElementById('map-error'); if (me) me.style.display = 'block';
        initLeafletMap();
      };
      document.head.appendChild(s);

      // Safety timeout: si no se inicializa, caemos a Leaflet
      setTimeout(function () {
        if (!window.google || !window.google.maps) {
          console.warn('Google Maps no inicializó a tiempo. Usando Leaflet.');
          document.getElementById('map-error').style.display = 'block';
          initLeafletMap();
        }
      }, 5000);
    }

    // ------- UI & interactions -------
    document.addEventListener('DOMContentLoaded', () => {
      // Inicializar emails/año
      const emailContactEl = document.getElementById('email-contact');
      const emailFooterEl = document.getElementById('email-footer');
      if (emailContactEl) { emailContactEl.textContent = EMAIL_CONTACT; emailContactEl.href = `mailto:${EMAIL_CONTACT}`; }
      if (emailFooterEl) { emailFooterEl.textContent = EMAIL_CONTACT; emailFooterEl.href = `mailto:${EMAIL_CONTACT}`; }
      const yearEl = document.getElementById('year');
      if (yearEl) yearEl.textContent = new Date().getFullYear();

      // Menu mobile
      const menuButton = document.getElementById('menu-button');
      const mobileMenu = document.getElementById('mobile-menu');
      const menuOpenIcon = document.getElementById('menu-open-icon');
      const menuCloseIcon = document.getElementById('menu-close-icon');
      const toggleMenu = () => {
        const isActive = mobileMenu.classList.toggle('active');
        menuOpenIcon.classList.toggle('hidden');
        menuCloseIcon.classList.toggle('hidden');
        document.body.style.overflow = isActive ? 'hidden' : 'auto';
        menuButton.setAttribute('aria-expanded', isActive);
        mobileMenu.setAttribute('aria-hidden', !isActive);
      };
      if (menuButton) { menuButton.addEventListener('click', toggleMenu); }
      if (mobileMenu) { mobileMenu.querySelectorAll('a').forEach(link => link.addEventListener('click', toggleMenu)); }

      // Modal de imagenes
      const modal = document.getElementById('imageModal');
      const modalImage = document.getElementById('modalImage');
      const modalCaption = document.getElementById('modalCaption');
      window.openModal = (src, caption) => {
        if (!modal) return;
        modal.style.display = 'flex';
        if (modalImage) modalImage.src = src;
        if (modalCaption) modalCaption.textContent = caption;
        document.body.style.overflow = 'hidden';
        modal.setAttribute('aria-hidden', 'false');
      };
      window.closeModal = () => {
        if (!modal) return;
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
        modal.setAttribute('aria-hidden', 'true');
      };
      if (modal) modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });

      // IntersectionObserver para animar secciones
      const scrollObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => { if (entry.isIntersecting) entry.target.classList.add('visible'); });
      }, { threshold: 0.1 });
      document.querySelectorAll('.animate-on-scroll').forEach(el => scrollObserver.observe(el));

      // Scrollspy / header shadow
      const header = document.getElementById('header');
      const navLinks = document.querySelectorAll('.nav-link');
      const sections = document.querySelectorAll('main section[id]');
      const onScroll = () => {
        const scrollPos = window.scrollY + (header?.offsetHeight || 80) + 50;
        let activeSectionId = sections[0]?.id || '';
        sections.forEach(sec => { if (sec.offsetTop <= scrollPos) { activeSectionId = sec.id; } });
        navLinks.forEach(link => {
          link.classList.toggle('active', link.getAttribute('href') === `#${activeSectionId}`);
          link.classList.toggle('text-primary-600', link.getAttribute('href') === `#${activeSectionId}`);
        });
        if (header) header.classList.toggle('shadow-md', window.scrollY > 10);
      };
      window.addEventListener('scroll', onScroll);
      onScroll();

      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          e.preventDefault();
          const targetId = this.getAttribute('href');
          const targetElement = document.querySelector(targetId);
          if (targetElement) {
            const headerHeight = header?.offsetHeight || 80;
            window.scrollTo({ top: targetElement.offsetTop - headerHeight, behavior: 'smooth' });
          }
        });
      });

      // Testimonios slider
      const testimonialSlides = document.querySelectorAll('.testimonial-slide');
      let currentTestimonial = 0;
      const showTestimonial = (index) => { testimonialSlides.forEach((slide, i) => slide.classList.toggle('active', i === index)); };
      const nextTestBtn = document.getElementById('next-testimonial');
      const prevTestBtn = document.getElementById('prev-testimonial');
      if (nextTestBtn) nextTestBtn.addEventListener('click', () => { currentTestimonial = (currentTestimonial + 1) % testimonialSlides.length; showTestimonial(currentTestimonial); });
      if (prevTestBtn) prevTestBtn.addEventListener('click', () => { currentTestimonial = (currentTestimonial - 1 + testimonialSlides.length) % testimonialSlides.length; showTestimonial(currentTestimonial); });

      // Message modal helpers
      const msgModal = document.getElementById('messageModal');
      window.showMessageModal = (message, title = "Aviso") => {
        if (!msgModal) return;
        document.getElementById('messageModalTitle').textContent = title;
        document.getElementById('messageModalText').textContent = message;
        msgModal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
      };
      window.closeMessageModal = () => {
        if (!msgModal) return;
        msgModal.style.display = 'none';
        document.body.style.overflow = 'auto';
      };

      // Gemini suggester UI (kept simple)
      const geminiBtn = document.getElementById('gemini-suggester-btn');
      const cropInput = document.getElementById('contacto-cultivo');
      const messageInput = document.getElementById('contacto-mensaje');
      const geminiResponseContainer = document.getElementById('gemini-response-container');
      const geminiResponseText = document.getElementById('gemini-response-text');
      const geminiLoader = document.getElementById('gemini-loader');

      // Nota: NO colocar la API key de Gemini en el cliente.
      const geminiProxyUrl = '/generate-suggestion'; // tu servidor debe exponerlo (recomendado)

      async function fetchWithRetry(url, options, retries = 3) {
        for (let i = 0; i < retries; i++) {
          try {
            const response = await fetch(url, options);
            if (response.ok) { return response; }
            else if (response.status === 429) {
              const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
              await new Promise(resolve => setTimeout(resolve, delay));
            } else { throw new Error(`HTTP error! status: ${response.status}`); }
          } catch (error) {
            if (i === retries - 1) throw error;
            const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
            await new Promise(resolve => setTimeout(resolve, delay));
          }
        }
      }

      if (geminiBtn) {
        geminiBtn.addEventListener('click', async () => {
          const cultivo = cropInput?.value;
          const mensaje = messageInput?.value.trim();

          if (!cultivo || !mensaje) {
            showMessageModal("Por favor, selecciona un cultivo y describe tu problema para que la IA pueda ayudarte.", "Campos Requeridos");
            return;
          }

          geminiBtn.disabled = true;
          geminiBtn.classList.add('opacity-50');
          geminiResponseContainer.classList.remove('hidden');
          geminiLoader.classList.remove('hidden');
          geminiResponseText.textContent = '';
          geminiResponseContainer.scrollIntoView({ behavior: 'smooth' });

          const systemPrompt = "Actúa como un agrónomo experto. Tu objetivo es proporcionar un diagnóstico profesional y una sugerencia de acción inicial para un agricultor, basado en el cultivo y el problema que describe. La respuesta debe ser concisa, en un solo párrafo, y enfocada en soluciones. No te excedas en el texto. La sugerencia debe ser profesional y realista.";
          const userQuery = `Problema con el cultivo de ${cultivo}: "${mensaje}"`;

          const payload = { prompt: userQuery, system: systemPrompt, temperature: 0.4 };

          try {
            const response = await fetchWithRetry(geminiProxyUrl, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(payload)
            });

            if (!response) throw new Error("Fallo en la conexión después de múltiples reintentos.");
            const result = await response.json();
            const aiText = result?.text || result?.suggestion || null;

            if (aiText) geminiResponseText.textContent = aiText;
            else geminiResponseText.textContent = 'Lo sentimos, no pudimos generar una sugerencia. Por favor, intenta de nuevo más tarde.';
          } catch (error) {
            console.error('Error fetching from Gemini proxy:', error);
            geminiResponseText.textContent = 'Ocurrió un error al conectar con el asistente. Por favor, revisa tu conexión a internet e inténtalo de nuevo.';
          } finally {
            geminiLoader.classList.add('hidden');
            geminiBtn.disabled = false;
            geminiBtn.classList.remove('opacity-50');
          }
        });
      }

      // Contact form UTM capture
      const urlParams = new URLSearchParams(window.location.search);
      ['utm_source', 'utm_medium', 'utm_campaign'].forEach(k => {
        const el = document.getElementById(k);
        if (el) el.value = urlParams.get(k) || '';
      });

      // Lazy image loader
      (function robustLazyLoader() {
        const lazyImgs = Array.from(document.querySelectorAll('img.lazy'));
        if (!lazyImgs.length) return;
        const PLACEHOLDER = 'assets/hero-bg.jpg';
        function loadImg(img) {
          if (!img) return; if (!img.dataset || !img.dataset.src) return;
          img.onerror = function () {
            console.warn('Error cargando imagen:', img.dataset.src);
            if (img.getAttribute('data-placeholder-used')) return;
            img.src = PLACEHOLDER; img.setAttribute('data-placeholder-used', '1'); img.classList.add('loaded');
          };
          if (img.dataset.srcset) img.srcset = img.dataset.srcset;
          img.src = img.dataset.src; img.removeAttribute('data-src'); img.classList.add('loaded');
        }
        if ('IntersectionObserver' in window) {
          const observer = new IntersectionObserver((entries, obs) => {
            entries.forEach(entry => { if (entry.isIntersecting) { loadImg(entry.target); obs.unobserve(entry.target); } });
          }, { rootMargin: '300px 0px', threshold: 0.01 });

          lazyImgs.forEach(img => {
            const rect = img.getBoundingClientRect();
            if (rect.top < (window.innerHeight + 300)) { loadImg(img); } else { observer.observe(img); }
          });

          window.addEventListener('resize', () => {
            lazyImgs.forEach(img => {
              if (img.dataset && img.dataset.src) {
                const rect = img.getBoundingClientRect();
                if (rect.top < (window.innerHeight + 300)) { loadImg(img); try { observer.unobserve(img); } catch (_) { } }
              }
            });
          });
        } else { lazyImgs.forEach(img => loadImg(img)); }
      })();

      // Defensas para evitar inicializaciones dobles de widgets externos
      if (window.Ada && !window.__ada_started) {
        try { if (typeof window.Ada.start === 'function') { window.Ada.start(); window.__ada_started = true; } } catch (err) { console.warn('Ada start safe guard failed', err); }
      }
      if (window.Ketch && !window.__ketch_init_done) {
        try { if (typeof window.Ketch.init === 'function') { window.Ketch.init({ purposes: ['analytics', 'functional', 'marketing'] }); } window.__ketch_init_done = true; } catch (err) { console.warn('Ketch init guard failed', err); }
      }

      // Finalmente: cargar Maps (Google preferido; si falla -> Leaflet)
      try {
        loadGoogleMapsScript();
      } catch (err) {
        console.warn('Error cargando Google Maps, usando Leaflet', err);
        initLeafletMap();
      }
    }); // DOMContentLoaded end

    // Message modal helpers (global)
    function showMessageModal(message, title = 'Aviso') {
      const msgModal = document.getElementById('messageModal');
      if (msgModal) {
        document.getElementById('messageModalTitle').textContent = title;
        document.getElementById('messageModalText').textContent = message;
        msgModal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
      }
    }
    function closeMessageModal() {
      const msgModal = document.getElementById('messageModal');
      if (msgModal) { msgModal.style.display = 'none'; document.body.style.overflow = 'auto'; }
    }
  </script>
</body>

</html>